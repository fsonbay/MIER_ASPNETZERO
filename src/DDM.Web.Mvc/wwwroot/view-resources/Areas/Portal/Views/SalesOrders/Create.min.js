(function(){function t(n){var r=n.getFullYear(),i=(1+n.getMonth()).toString(),t;return i=i.length>1?i:"0"+i,t=n.getDate().toString(),t=t.length>1?t:"0"+t,t+"/"+i+"/"+r}function i(n){var t=n.split("/");return new Date(+t[2],t[1]-1,+t[0])}function r(n,t,i,r){var u,f,e,o;for(n=n.replace(/\./g,""),u=n.replace(/\./g,""),u+="",f=u.indexOf(t),e="",f!==-1&&(e=i+u.substring(f+1,u.length),u=u.substring(0,f)),o=/(\d+)(\d{3})/;o.test(u);)u=u.replace(o,"$1"+r+"$2");return u+e}function s(){$(".line-set").each(function(){var n=$(this).index();$(":input",this).each(function(){this.name=this.name.replace(/[0-9]+/,n);this.id=this.id.replace(/[0-9]+/,n)})})}function u(){var n=$(".line-set").length;n===1?$(".line-set .delete-line").hide():$(".line-set .delete-line").show()}function tt(){var n=0;$(".line-amount").each(function(){var t=this.value.replace(/\./g,""),i;isNaN(t)||t.length===0?t.length!==0&&$(this).css("background-color","red"):(i=$(this).parents(".line-set"),i.is(":visible")&&(n+=parseFloat(t),$(this).css("background-color","#FEFFB0")))});nt.val(r(n.toString(),".",",","."))}var h=$("form[name = SalesOrderForm]"),c=$(".date-picker"),l=$("#1Button"),a=$("#2Button"),v=$("#3Button"),y=$("#4Button"),p=$("#5Button"),n=$("#SalesOrder_Deadline"),w=$("#CreateNewCustomerButton"),b=$(".line-sets"),it=$(".line-set"),k=$("#AddLineButton"),d=$(".delete-line"),rt=$(".line-amount"),g=$(".line-calculation"),nt=$("#Total"),f,e,o;u();f=function(){var r,t,i,n,u=function(){n=new KTWizard("kt_wizard",{startStep:1});n.on("beforeNext",function(n){i.form()!==!0&&n.stop()});n.on("beforePrev",function(n){i.form()!==!0&&n.stop()});n.on("change",function(){setTimeout(function(){KTUtil.scrollTop()},500)})},f=function(){i=t.validate({ignore:":hidden",rules:{CustomerId:{required:!0},Date:{required:!0},Deadline:{required:!0}},invalidHandler:function(){KTUtil.scrollTop()},submitHandler:function(){}})},e=function(){var n=t.find('[data-wizard-type="action-submit"]');n.on("click",function(){var n=h.serializeFormToObject(),t=JSON.stringify(n);_salesOrdersService.createOrEdit(n).done(function(){abp.notify.info(app.localize("SavedSuccessfully"))})})};return{init:function(){r=KTUtil.getById("kt_wizard");t=$("#SalesOrderForm");u();f();e()}}}();jQuery(document).ready(function(){f.init()});e=new app.ModalManager({viewUrl:abp.appPath+"Portal/Customers/CreateOrEditModal",scriptUrl:abp.appPath+"view-resources/Areas/Portal/Views/SalesOrders/_CreateCustomerModal.js",modalClass:"CreateCustomerModal"});w.click(function(n){n.preventDefault();e.open()});c.datetimepicker({locale:abp.localization.currentLanguage.name,format:"DD/MM/YYYY"});l.click(function(r){r.preventDefault();var u=i(n.val());u.setDate(u.getDate()+1);n.val(t(u))});a.click(function(r){r.preventDefault();var u=i(n.val());u.setDate(u.getDate()+2);n.val(t(u))});v.click(function(r){r.preventDefault();var u=i(n.val());u.setDate(u.getDate()+3);n.val(t(u))});y.click(function(r){r.preventDefault();var u=i(n.val());u.setDate(u.getDate()+4);n.val(t(u))});p.click(function(r){r.preventDefault();var u=i(n.val());u.setDate(u.getDate()+5);n.val(t(u))});o=b;k.click(function(n){n.preventDefault();var t=$(".line-set:last").clone(!0);t.find(":input").each(function(){$(this).val("");$(this).hasClass("mark-for-delete")&&$(this).val("False");$(this).hasClass("line-id")&&$(this).val("0")});o.append(t);$(".line-set:last-child :input:enabled:visible:first").focus();s();u()});d.click(function(n){n.preventDefault();$(this).parents(".line-set").find(".mark-for-delete").val("true");var t=$(this).parents(".line-set").find(".line-id").val();t==="0"?$(this).parents(".line-set").remove():$(this).parents(".line-set").hide();s();u()});g.keyup(function(){var n=$(this).attr("name"),i=n.indexOf("[")+1,u=n.indexOf("]",i),t=n.substring(i,u),f='input[name="SalesOrderLines['+t+'].Quantity"]',e='input[name="SalesOrderLines['+t+'].Price"]',o='input[name="SalesOrderLines['+t+'].Amount"]',s=$(f).val().replace(/\./g,""),h=$(e).val().replace(/\./g,""),c=s*h;$(o).val(r(c.toString(),".",",","."));$(this).val(function(n,t){return r(t,".",",",".")});tt()})})();